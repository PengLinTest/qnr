(function(d){var f=1;d.widget("custom.singleTree",{options:{treeType:1,userTag:"\u7528\u6237",orgTag:"\u7ec4\u7ec7",userUrl:"/BaseService.svc/GetOrgUsersTree",orgUrl:"/BaseService.svc/GetOrgTree",checkCallback:null,isComboStyle:!1,functionId:0,operateId:0},_zTreeId:"tree_singleTree",_create:function(){f++;this._zTreeId="tree_singleTree"+f;this.wrapper=d(String.format('<ul id="{0}" class="ztree" ></ul>',this._zTreeId)).appendTo(this.element);"function"===typeof this.options.checkCallback&&d("#"+this._zTreeId).data("checkCallback",
this.options.checkCallback);d("#"+this._zTreeId).data("isComboStyle",this.options.isComboStyle);Transfer.loadCSS(["/Plugins/ZTree/zTreeStyle.css"]);this._getOrgUsersTree()},_getOrgUsersTree:function(){var b=this,a="",c=1==b.options.treeType;0<d("#"+b._zTreeId).children().length||(a=c?b.options.userUrl:b.options.orgUrl,AccountGlobalInfo.executeWhenUser(function(e){Service.post({url:a,params:{UserID:e.UserID,FunctionID:b.options.functionId,OperateID:b.options.operateId},success:function(a){0<a.Items.length&&
Transfer.loadScripts(["/Plugins/ZTree/jquery.ztree.core-3.5.min.js","/Plugins/ZTree/jquery.ztree.excheck-3.5.min.js"],function(){c&&d.each(a.Items,function(b,a){2>a.RowType?a.nocheck=!0:(a.nocheck=!1,a.iconSkin="icon09")});b._zTreeInit(a.Items,b._zTreeSettings)})},mask:function(){d(b._dialog).mask("\u6b63\u5728\u52a0\u8f7d\u6570\u636e...")},unmask:function(){d(b._dialog).unmask("")}})}))},_zTreeSettings:{check:{enable:!0,chkboxType:{Y:"s",N:"s"}},data:{simpleData:{enable:!0,idKey:"OrgID",pIdKey:"ParentOrgID",
rootPId:0},key:{name:"Name"}},callback:{onCheck:function(b,a,c){b=d("#"+a).data("checkCallback");c=d("#"+a).data("isComboStyle")||!1;"function"===typeof b&&b();if(c&&(b=d("#"+a).parent().prev().find("input").first(),1==b.length)){c=[];a=d.fn.zTree.getZTreeObj(a).getCheckedNodes(!0);for(var e=0,f=a.length;e<f;e++)c.push(a[e].Name);a=c.join(",")?c.join(","):"\u5168\u90e8\u7ec4\u7ec7";b.val(a)}}}},_zTreeInit:function(b,a){d.fn.zTree.init(d("#"+this._zTreeId),a,b);var c=d.fn.zTree.getZTreeObj(this._zTreeId);
c&&c.expandAll(!0)},getResult:function(){for(var b=[],a=d.fn.zTree.getZTreeObj(this._zTreeId).getCheckedNodes(!0),c=0,e=a.length;c<e;c++)b.push(a[c].OrgID-a[c].AddValue);return b},_destroy:function(){this.wrapper.remove()}})})(jQuery);
