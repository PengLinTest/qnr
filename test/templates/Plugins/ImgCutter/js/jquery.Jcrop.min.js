(function(e){e.Jcrop=function(w,v){function h(a){return Math.round(a)+"px"}function E(a){a=e(a).offset();return[a.left,a.top]}function z(a){return[a.pageX-H[0],a.pageY-H[1]]}function F(b){"object"!=typeof b&&(b={});a=e.extend(a,b);e.each(["onChange","onSelect","onRelease","onDblClick"],function(b,n){"function"!=typeof a[n]&&(a[n]=function(){})})}function da(a,g,n){H=E(q);C.setCursor("move"===a?a:a+"-resize");if("move"===a)return C.activateHandlers(ua(g),Y,n);g=s.getFixed();var e=ea(a),c=s.getCorner(ea(e));
s.setPressed(s.getCorner(e));s.setCurrent(c);C.activateHandlers(va(a,g),Y,n)}function va(b,g){return function(n){if(a.aspectRatio)switch(b){case "e":n[1]=g.y+1;break;case "w":n[1]=g.y+1;break;case "n":n[0]=g.x+1;break;case "s":n[0]=g.x+1}else switch(b){case "e":n[1]=g.y2;break;case "w":n[1]=g.y2;break;case "n":n[0]=g.x2;break;case "s":n[0]=g.x2}s.setCurrent(n);p.update()}}function ua(a){var g=a;return Z.watchKeys(),function(a){s.moveOffset([a[0]-g[0],a[1]-g[1]]);g=a;p.update()}}function ea(a){switch(a){case "n":return"sw";
case "s":return"nw";case "e":return"nw";case "w":return"ne";case "ne":return"sw";case "nw":return"se";case "se":return"nw";case "sw":return"ne"}}function ga(b){return function(g){return a.disabled?!1:"move"!==b||a.allowMove?(H=E(q),L=!0,da(b,z(g)),g.stopPropagation(),g.preventDefault(),!1):!1}}function ha(a,g,n){var e=a.width(),c=a.height();e>g&&0<g&&(e=g,c=g/a.width()*a.height());c>n&&0<n&&(c=n,e=n/a.height()*a.width());x=a.width()/e;y=a.height()/c;a.width(e).height(c)}function Q(a){return{x:a.x*
x,y:a.y*y,x2:a.x2*x,y2:a.y2*y,w:a.w*x,h:a.h*y}}function Y(b){b=s.getFixed();b.w>a.minSelect[0]&&b.h>a.minSelect[1]?(p.enableHandles(),p.done()):p.release();C.setCursor(a.allowSelect?"crosshair":"default")}function ia(b){if(a.disabled||!a.allowSelect)return!1;L=!0;H=E(q);p.disableHandles();C.setCursor("crosshair");var g=z(b);return s.setPressed(g),p.update(),C.activateHandlers(wa,Y,"touch"===b.type.substring(0,5)),Z.watchKeys(),b.stopPropagation(),b.preventDefault(),!1}function wa(a){s.setCurrent(a);
p.update()}function ja(){var b=e("<div></div>").addClass(a.baseClass+"-tracker");return ka&&b.css({opacity:0,backgroundColor:"white"}),b}function la(b){ma([b[0]/x,b[1]/y,b[2]/x,b[3]/y]);a.onSelect.call(B,Q(s.getFixed()));p.enableHandles()}function ma(a){s.setPressed([a[0],a[1]]);s.setCurrent([a[2],a[3]]);p.update()}function na(){a.disabled=!0;p.disableHandles();p.setCursor("default");C.setCursor("default")}function oa(){a.disabled=!1;$()}function aa(b,g,n){g=g||a.bgColor;a.bgFade&&e.fx.step.hasOwnProperty("backgroundColor")&&
a.fadeTime&&!n?b.animate({backgroundColor:g},{queue:!1,duration:a.fadeTime}):b.css("backgroundColor",g)}function $(b){a.allowResize?b?p.enableOnly():p.enableHandles():p.disableHandles();C.setCursor(a.allowSelect?"crosshair":"default");p.setCursor(a.allowMove?"move":"default");a.hasOwnProperty("trueSize")&&(x=a.trueSize[0]/t,y=a.trueSize[1]/m);a.hasOwnProperty("setSelect")&&(la(a.setSelect),p.done(),delete a.setSelect);I.refresh();a.bgColor!=pa&&(aa(a.shade?I.getShades():G,a.shade?a.shadeColor||a.bgColor:
a.bgColor),pa=a.bgColor);R!=a.bgOpacity&&(R=a.bgOpacity,a.shade?I.refresh():p.setBgOpacity(R));S=a.maxSize[0]||0;T=a.maxSize[1]||0;U=a.minSize[0]||0;V=a.minSize[1]||0;a.hasOwnProperty("outerImage")&&(q.attr("src",a.outerImage),delete a.outerImage);p.refresh()}var a=e.extend({},e.Jcrop.defaults),H,M=navigator.userAgent.toLowerCase(),ka=/msie/.test(M),qa=/msie [1-6]\./.test(M);"object"!=typeof w&&(w=e(w)[0]);"object"!=typeof v&&(v={});F(v);var M={border:"none",visibility:"visible",margin:0,padding:0,
position:"absolute",top:0,left:0},u=e(w),ra=!0;if("IMG"==w.tagName){if(0!=u[0].width&&0!=u[0].height)u.width(u[0].width),u.height(u[0].height);else{var ba=new Image;ba.src=u[0].src;u.width(ba.width);u.height(ba.height)}var q=u.clone().removeAttr("id").css(M).show();q.width(u.width());q.height(u.height());u.after(q).hide()}else q=u.css(M).show(),ra=!1,null===a.shade&&(a.shade=!0);ha(q,a.boxWidth,a.boxHeight);var t=q.width(),m=q.height(),G=e("<div />").width(t).height(m).addClass(a.baseClass+"-holder").css({position:"relative",
backgroundColor:a.bgColor}).insertAfter(u).append(q);a.addClass&&G.addClass(a.addClass);var J=e("<div />"),X=e("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),N=e("<div />").width("100%").height("100%").css("zIndex",320),O=e("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var b=s.getFixed();a.onDblClick.call(B,b)}).insertBefore(q).append(X,N);ra&&(J=e("<img />").attr("src",q.attr("src")).css(M).width(t).height(m),X.append(J));qa&&
O.css({overflowY:"hidden"});var P=a.boundary,K=ja().width(t+2*P).height(m+2*P).css({position:"absolute",top:h(-P),left:h(-P),zIndex:290}).mousedown(ia),pa=a.bgColor,R=a.bgOpacity,S,T,U,V,x,y,L,ca,xa;H=E(q);var A=function(){function b(){var a={},b=["touchstart","touchmove","touchend"],e=document.createElement("div"),c;try{for(c=0;c<b.length;c++){var d=b[c],d="on"+d,f=d in e;f||(e.setAttribute(d,"return;"),f="function"==typeof e[d]);a[b[c]]=f}return a.touchstart&&a.touchend&&a.touchmove}catch(k){return!1}}
return{createDragger:function(b){return function(e){return a.disabled?!1:"move"!==b||a.allowMove?(H=E(q),L=!0,da(b,z(A.cfilter(e)),!0),e.stopPropagation(),e.preventDefault(),!1):!1}},newSelection:function(a){return ia(A.cfilter(a))},cfilter:function(a){return a.pageX=a.originalEvent.changedTouches[0].pageX,a.pageY=a.originalEvent.changedTouches[0].pageY,a},isSupported:b,support:!0===a.touchSupport||!1===a.touchSupport?a.touchSupport:b()}}(),s=function(){function b(){if(!a.aspectRatio){var l=f-c,r=
k-d,b;return S&&Math.abs(l)>S&&(f=0<l?c+S:c-S),T&&Math.abs(r)>T&&(k=0<r?d+T:d-T),V/y&&Math.abs(r)<V/y&&(k=0<r?d+V/y:d-V/y),U/x&&Math.abs(l)<U/x&&(f=0<l?c+U/x:c-U/x),0>c&&(f-=c,c-=c),0>d&&(k-=d,d-=d),0>f&&(c-=f,f-=f),0>k&&(d-=k,k-=k),f>t&&(b=f-t,c-=b,f-=b),k>m&&(b=k-m,d-=b,k-=b),c>t&&(b=c-m,k-=b,d-=b),d>m&&(b=d-m,k-=b,d-=b),p(n(c,d,f,k))}b=a.aspectRatio;var e=a.minSize[0]/x,g=a.maxSize[0]/x,q=f-c,h=k-d,sa=Math.abs(q),ta=Math.abs(h),D,s;return 0===g&&(g=10*t),sa/ta<b?(r=k,D=ta*b,l=0>q?c-D:D+c,0>l?(l=
0,s=Math.abs((l-c)/b),r=0>h?d-s:s+d):l>t&&(l=t,s=Math.abs((l-c)/b),r=0>h?d-s:s+d)):(l=f,s=sa/b,r=0>h?d-s:d+s,0>r?(r=0,D=Math.abs((r-d)*b),l=0>q?c-D:D+c):r>m&&(r=m,D=Math.abs(r-d)*b,l=0>q?c-D:D+c)),l>c?(l-c<e?l=c+e:l-c>g&&(l=c+g),r>d?r=d+(l-c)/b:r=d-(l-c)/b):l<c&&(c-l<e?l=c-e:c-l>g&&(l=c-g),r>d?r=d+(c-l)/b:r=d-(c-l)/b),0>l?(c-=l,l=0):l>t&&(c-=l-t,l=t),0>r?(d-=r,r=0):r>m&&(d-=r-m,r=m),p(n(c,d,l,r))}function e(a){return 0>a[0]&&(a[0]=0),0>a[1]&&(a[1]=0),a[0]>t&&(a[0]=t),a[1]>m&&(a[1]=m),[Math.round(a[0]),
Math.round(a[1])]}function n(a,b,c,d){var e=a,g=c,k=b,f=d;return c<a&&(e=c,g=a),d<b&&(k=d,f=b),[e,k,g,f]}function p(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var c=0,d=0,f=0,k=0,q,h;return{flipCoords:n,setPressed:function(a){a=e(a);f=c=a[0];k=d=a[1]},setCurrent:function(a){a=e(a);q=a[0]-f;h=a[1]-k;f=a[0];k=a[1]},getOffset:function(){return[q,h]},moveOffset:function(a){var b=a[0];a=a[1];0>c+b&&(b-=b+c);0>d+a&&(a-=a+d);m<k+a&&(a+=m-(k+a));t<f+b&&(b+=t-(f+b));c+=b;f+=b;d+=a;k+=
a},getCorner:function(a){var c=b();switch(a){case "ne":return[c.x2,c.y];case "nw":return[c.x,c.y];case "se":return[c.x2,c.y2];case "sw":return[c.x,c.y2]}},getFixed:b}}(),I=function(){function b(){return g(s.getFixed())}function g(a){l.top.css({left:h(a.x),width:h(a.w),height:h(a.y)});l.bottom.css({top:h(a.y2),left:h(a.x),width:h(a.w),height:h(m-a.y2)});l.right.css({left:h(a.x2),width:h(t-a.x2)});l.left.css({width:h(a.x)})}function n(){return e("<div />").css({position:"absolute",backgroundColor:a.shadeColor||
a.bgColor}).appendTo(u)}function fa(){W||(W=!0,u.insertBefore(q),b(),p.setBgOpacity(1,0,1),J.hide(),c(a.shadeColor||a.bgColor,1),p.isAwake()?f(a.bgOpacity,1):f(1,1))}function c(a,b){aa(k(),a,b)}function d(){W&&(u.remove(),J.show(),W=!1,p.isAwake()?p.setBgOpacity(a.bgOpacity,1,1):(p.setBgOpacity(1,1,1),p.disableHandles()),aa(G,0,1))}function f(b,c){W&&(a.bgFade&&!c?u.animate({opacity:1-b},{queue:!1,duration:a.fadeTime}):u.css({opacity:1-b}))}function k(){return u.children()}var W=!1,u=e("<div />").css({position:"absolute",
zIndex:240,opacity:0}),l={top:n(),left:n().height(m),right:n().height(m),bottom:n()};return{update:b,updateRaw:g,getShades:k,setBgColor:c,enable:fa,disable:d,resize:function(a,b){l.left.css({height:h(b)});l.right.css({height:h(b)})},refresh:function(){a.shade?fa():d();p.isAwake()&&f(a.bgOpacity)},opacity:f}}(),p=function(){function b(a,b){var c=e("<div />").mousedown(ga(a)).css({cursor:a+"-resize",position:"absolute",zIndex:b}).addClass("ord-"+a);return A.support&&c.bind("touchstart.jcrop",A.createDragger(a)),
N.append(c),c}function g(a){var c;for(c=0;c<a.length;c++)b(a[c],u++).addClass("jcrop-dragbar")}function n(b){var c,d;for(d=0;d<b.length;d++){switch(b[d]){case "n":c="hline";break;case "s":c="hline bottom";break;case "e":c="vline right";break;case "w":c="vline"}var g=x,k=b[d],f;f=c;f=e("<div />").css({position:"absolute",opacity:a.borderOpacity}).addClass(a.baseClass+"-"+f);f=(X.append(f),f);g[k]=f}}function p(c){var d;for(d=0;d<c.length;d++){var e=y,g=c[d],f;f=a.handleSize;var k=b(c[d],u++).css({opacity:a.handleOpacity}).addClass(a.baseClass+
"-handle");f=(f&&k.width(f).height(f),k);e[g]=f}}function c(){var a=s.getFixed();s.setPressed([a.x,a.y]);s.setCurrent([a.x2,a.y2]);d()}function d(a){if(r)return f(a)}function f(b){var c=s.getFixed(),d=c.h;O.width(Math.round(c.w)).height(Math.round(d));var d=c.x,e=c.y;a.shade||J.css({top:h(-e),left:h(-d)});O.css({top:h(e),left:h(d)});a.shade&&I.updateRaw(c);r||(O.show(),a.shade?I.opacity(R):k(R,!0),r=!0);b?a.onSelect.call(B,Q(c)):a.onChange.call(B,Q(c))}function k(b,c,d){if(r||c)a.bgFade&&!d?q.animate({opacity:b},
{queue:!1,duration:a.fadeTime}):q.css("opacity",b)}function m(){w=!0;if(a.allowResize)return N.show(),!0}function t(){w=!1;N.hide()}function l(a){a?(ca=!0,t()):(ca=!1,m())}var r,u=370,x={},y={},w=!1;a.dragEdges&&e.isArray(a.createDragbars)&&g(a.createDragbars);e.isArray(a.createHandles)&&p(a.createHandles);a.drawBorders&&e.isArray(a.createBorders)&&n(a.createBorders);e(document).bind("touchstart.jcrop-ios",function(a){e(a.currentTarget).hasClass("jcrop-tracker")&&a.stopPropagation()});var v=ja().mousedown(ga("move")).css({cursor:"move",
position:"absolute",zIndex:360});return A.support&&v.bind("touchstart.jcrop",A.createDragger("move")),X.append(v),t(),{updateVisible:d,update:f,release:function(){t();O.hide();a.shade?I.opacity(1):k(1);r=!1;a.onRelease.call(B)},refresh:c,isAwake:function(){return r},setCursor:function(a){v.css("cursor",a)},enableHandles:m,enableOnly:function(){w=!0},showHandles:function(){w&&N.show()},disableHandles:t,animMode:l,setBgOpacity:k,done:function(){l(!1);c()}}}(),C=function(){function b(a){return c(z(a)),
!1}function g(b){b.preventDefault();b.stopPropagation();L&&(L=!1,d(z(b)),p.isAwake()&&a.onSelect.call(B,Q(s.getFixed())),K.css({zIndex:290}),e(document).unbind(".jcrop"),c=function(){},d=function(){});return!1}function n(a){return c(z(A.cfilter(a))),!1}function h(a){return g(A.cfilter(a))}var c=function(){},d=function(){},f=a.trackDocument;return f||K.mousemove(b).mouseup(g).mouseout(g),q.before(K),{activateHandlers:function(a,p,q){L=!0;c=a;d=p;K.css({zIndex:450});q?e(document).bind("touchmove.jcrop",
n).bind("touchend.jcrop",h):f&&e(document).bind("mousemove.jcrop",b).bind("mouseup.jcrop",g);return!1},setCursor:function(a){K.css("cursor",a)}}}(),Z=function(){function b(a){h.hide()}function g(b,c,e){a.allowMove&&(s.moveOffset([c,e]),p.updateVisible(!0));b.preventDefault();b.stopPropagation()}function n(b){if(b.ctrlKey||b.metaKey)return!0;var c=(xa=b.shiftKey?!0:!1)?10:1;switch(b.keyCode){case 37:g(b,-c,0);break;case 39:g(b,c,0);break;case 38:g(b,0,-c);break;case 40:g(b,0,c);break;case 27:a.allowSelect&&
p.release();break;case 9:return!0}return!1}var h=e('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),c=e("<div />").css({position:"absolute",overflow:"hidden"}).append(h);return a.keySupport&&(h.keydown(n).blur(b),qa||!a.fixedSupport?(h.css({position:"absolute",left:"-20px"}),c.append(h).insertBefore(q)):h.insertBefore(q)),{watchKeys:function(){a.keySupport&&(h.show(),h.focus())}}}();A.support&&K.bind("touchstart.jcrop",A.newSelection);N.hide();
$(!0);var B={setImage:function(b,e){p.release();na();var n=new Image;n.onload=function(){var h=n.height,c=a.boxWidth,d=a.boxHeight;q.width(n.width).height(h);q.attr("src",b);J.attr("src",b);ha(q,c,d);t=q.width();m=q.height();J.width(t).height(m);K.width(t+2*P).height(m+2*P);G.width(t).height(m);I.resize(t,m);oa();"function"==typeof e&&e.call(B)};n.src=b},animateTo:function(b,e){var h=b[0]/x,q=b[1]/y,c=b[2]/x,d=b[3]/y;if(!ca){var f=s.flipCoords(h,q,c,d),k=s.getFixed(),m=[k.x,k.y,k.x2,k.y2],t=a.animationDelay,
l=f[0]-m[0],r=f[1]-m[1],u=f[2]-m[2],w=f[3]-m[3],v=0,z=a.swingSpeed,h=m[0],q=m[1],c=m[2],d=m[3];p.animMode(!0);var A=function(){return function(){v+=(100-v)/z;m[0]=Math.round(h+v/100*l);m[1]=Math.round(q+v/100*r);m[2]=Math.round(c+v/100*u);m[3]=Math.round(d+v/100*w);99.8<=v&&(v=100);100>v?(ma(m),window.setTimeout(A,t)):(p.done(),p.animMode(!1),"function"==typeof e&&e.call(B))}}();window.setTimeout(A,t)}},setSelect:la,setOptions:function(a){F(a);$()},tellSelect:function(){return Q(s.getFixed())},tellScaled:function(){return s.getFixed()},
setClass:function(b){G.removeClass().addClass(a.baseClass+"-holder").addClass(b)},disable:na,enable:oa,cancel:function(){p.done();C.activateHandlers(null,null)},release:p.release,destroy:function(){G.remove();u.show();u.css("visibility","visible");e(w).removeData("Jcrop")},focus:Z.watchKeys,getBounds:function(){return[t*x,m*y]},getWidgetSize:function(){return[t,m]},getScaleFactor:function(){return[x,y]},getOptions:function(){return a},ui:{holder:G,selection:O}};return ka&&G.bind("selectstart",function(){return!1}),
u.data("Jcrop",B),B};e.fn.Jcrop=function(w,v){var h;return this.each(function(){if(e(this).data("Jcrop")){if("api"===w)return e(this).data("Jcrop");e(this).data("Jcrop").setOptions(w)}else"IMG"==this.tagName?e.Jcrop.Loader(this,function(){e(this).css({display:"block",visibility:"hidden"});h=e.Jcrop(this,w);e.isFunction(v)&&v.call(h)}):(e(this).css({display:"block",visibility:"hidden"}),h=e.Jcrop(this,w),e.isFunction(v)&&v.call(h))}),this};e.Jcrop.Loader=function(w,v,h){function E(){F.complete?(z.unbind(".jcloader"),
e.isFunction(v)&&v.call(F)):window.setTimeout(E,50)}var z=e(w),F=z[0];z.bind("load.jcloader",E).bind("error.jcloader",function(v){z.unbind(".jcloader");e.isFunction(h)&&h.call(F)});F.complete&&e.isFunction(v)&&(z.unbind(".jcloader"),v.call(F))};e.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:0.6,bgFade:!1,borderOpacity:0.4,handleOpacity:0.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:"n s e w nw ne se sw".split(" "),
createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}})(jQuery);
